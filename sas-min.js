/*!
 *version:2.0.12  Released: jQuery.Release 
 *repository:https://github.com/hezedu/sas
 *by hezedu 2015/11/16
*/

function sas(t,s,e){var i;if("object"!=typeof s)switch(arguments.length){case 2:e=s;break;case 3:i=s;break;default:s={}}else i=s.iterator,e=e||s.allEnd;new sas.min(t,i,e,s)}sas.type=Object.prototype.toString,sas.ARR="[object Array]",sas.FN="[object Function]",sas.OBJ="[object Object]",sas.errHandle=function(t){return function(s,e){return s?t("$STOP",s):void t(e)}},sas.copy=function(t){var s=[];return this._copy([t],0,s),s[0]},sas._copy=function(t,s,e){switch(this.type.call(t[s])){case this.OBJ:e[s]={};for(var i in t[s])this._copy(t[s],i,e[s]);break;case this.ARR:e[s]=[],len=t[s].length;for(var i=0;i<len;i++)this._copy(t[s],i,e[s]);break;default:e[s]=t[s]}},sas.min=function(t,s,e,i){this.tasks_count=0,this.tasks_count_cb=0,this.STOP=!1,this.error=null,this.end=e,this.ite=s,this.process=i.process,this.process_interval=i.process_interval||1e3,this.plan=i.copy?sas.copy(t):t,this.init()},sas.min.prototype.init=function(){var t=[1,0];this.plan=[this.plan],this.dis(t[1],this.plan,t),this._process()},sas.min.prototype.dis=function(t,s,e,i){if(!this.STOP)switch(sas.type.call(s[t])){case sas.FN:this.forFn(t,s,e,i);break;case sas.OBJ:for(var n=Object.keys(s[t]),a=n.length,o=[a,0],r=0;a>r;r++)this.dis(n[r],s[t],o,arguments);break;case sas.ARR:var o=[s[t].length,0];this.dis(o[1],s[t],o,arguments);break;default:this.ite&&void 0!==s[t]?(s[t]=this.ite(s[t]),this.forFn(t,s,e,i)):(e[1]++,this.next_tick(t,s,e,i))}},sas.min.prototype.forFn=function(t,s,e,i){function n(n,a){if(o.tasks_count_cb++,!o.STOP&&e[0]!==e[1]){switch(n){case void 0:e[1]++;break;case"$STOP":return o.error=a||new Error("sas $STOP"),o._end(),o.STOP=!0;case"$THIS=":i[1][i[0]]=a,e[1]=e[0];break;case"$END":e[1]=e[0];break;case"$GO":a=a||1,e[1]+=a,e[1]=e[1]<0?0:e[1]>e[0]?e[0]:e[1];break;case"$RELOAD":return s[t]=a||s[t],o.dis(t,s,e,i);default:e[1]++,s[t]=n}o.next_tick(t,s,e,i)}}this.tasks_count++;var a=null,o=this;s[t].length>1&&(a=new sas.Index(t,s,e,i)),s[t](n,a)},sas.min.prototype.next_tick=function(t,s,e,i){e[0]===e[1]?i?(i[2][1]++,this.next_tick.apply(this,i)):this._end():"number"==typeof t&&this.dis(e[1],s,e,i)},sas.min.prototype._process=function(){if(this.process){var t=this;t._t=setInterval(function(){t.process(t.tasks_count,t.tasks_count_cb)},t.process_interval)}},sas.min.prototype._end=function(){this.process&&(clearInterval(this._t),this.process(this.tasks_count,this.tasks_count_cb)),this.end&&this.end(this.error,this.plan[0])},sas.Index=function(t,s,e,i){this.index=t,this.path=[t],this.count=e;var n,a=0,o=!1;for(n=i,this.parent=i[1],this.pIndex=i[0];n[3];)a++,o||"number"!=typeof n[0]||(this.Sparent=n[1],this.SpIndex=n[0],o=!0),this.path.splice(0,0,n[0]),n=n[3]},sas.Index.prototype.fspath=function(){for(var t=[],s=this.path,e=0,i=s.length;i>e;e++)"string"==typeof s[e]&&t.push(s[e]);return t},sas.Index.prototype.push=function(t){this.count[0]++,this.parent[this.pIndex].push(t)},"object"==typeof module&&"object"==typeof module.exports&&(module.exports=sas);