/*!
  *Version: 3.0.0
  *Author: Du Wei
  *Repository: https://github.com/hezedu/sas
  *Released: MIT
*/
!function(){function t(t,e,i){e?"function"==typeof e&&(i=e,e={}):e={},new s(t,e,i)}function s(t,s,e){this.tasks=t,this.result=s.context||{},this.tasksCount=0,this.tasksCbCount=0,this.error=null,this.end=e,this.ite=s.iterator,this.process=s.process,this.processInterval=s.processInterval||1e3,this.init()}function e(t,s,e){this.index=t,this._root=e,this._parents=arguments}var i=Object.prototype.toString;s.prototype.init=function(){var t=[1,0];this.dis(t[1],[this.tasks],t),this._process()},s.prototype.dis=function(t,s,e,n){if(!this.error){var r;switch(i.call(s[t])){case"[object Function]":this.forFn(t,s,e,n);break;case"[object Object]":var o=Object.keys(s[t]),h=o.length;r=[h,0];for(var c=0;c<h;c++)this.dis(o[c],s[t],r,arguments);break;case"[object Array]":r=[s[t].length,0],this.dis(r[1],s[t],r,arguments);break;default:this.ite&&void 0!==s[t]?(s[t]=this.ite(s[t]),this.forFn(t,s,e,n)):(e[1]++,this.nextTick(t,s,e,n))}}},s.prototype.forFn=function(t,s,i,n){function r(e,r){if(h.tasksCbCount++,!h.error&&i[0]!==i[1]){if(e)switch(e){case"$reload":return s[t]=r||c,h.dis(t,s,i,n);case"$up":i[1]=i[0];break;default:return h.error=e,void h._end()}else i[1]++;"$"===c.name[0]&&(h.result[c.name.substr(1)]=r),h.nextTick(t,s,i,n)}}this.tasksCount++;var o=null,h=this,c=s[t];c.length>1&&(o=new e(t,s,this.tasks,n)),c.call(this.result,r,o)},s.prototype.nextTick=function(t,s,e,i){e[0]===e[1]?i?(i[2][1]++,this.nextTick.apply(this,i)):this._end():"number"==typeof t&&this.dis(e[1],s,e,i)},s.prototype._process=function(){if(this.process){var t=this;t._t=setInterval(function(){t.process(t.tasksCount,t.tasksCbCount)},t.processInterval)}},s.prototype._end=function(){this.process&&(clearInterval(this._t),this.process(this.tasksCount,this.tasksCbCount)),this.end&&this.end(this.error,this.result)},e.prototype.indexs=function(){for(var t=this._parents,s=[];t[3];)s.splice(0,0,t[0]),t=t[3];return s},e.prototype.upperIndex=function(t){t=t||1;for(var s=this._parents;t>0&&s[1]!==this._root;)s=s[3],t--;if(0===t)return s[0]},"function"==typeof define&&define.amd?define(function(){return t}):this.sas=t}();